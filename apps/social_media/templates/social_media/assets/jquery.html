<!-- /templates/social_media/assets/jquery.html -->

<script type="text/javascript">
    $(document).ready(function() {

// ISOTOPE FUNCTIONS
    // isotope layout defined
        var $grid = $('.grid').isotope({
            itemSelector: '.grid-item',
            percentPosition: true,
            masonry: {
                columnWidth: '.grid-sizer'
            }
        });
    // load the images, allow in-time loading instead of waiting for all
        $grid.imagesLoaded().progress(function() {
            $grid.isotope('layout');
        });

        $(function() {
            $('[data-toggle="tooltip"]').tooltip();
        });


/* SCROLL TO TOP BUTTON FUNCTIONS */
        var $document = this;

    // when scrolling, call scroll button function
        $(window).on('scroll', function() {
            scrollButtonDisplay();
        });

    // show or hide scroll button based on scroll location
        function scrollButtonDisplay() {
            if ($document.body.scrollTop > 100 || $document.documentElement.scrollTop > 100) {
                $('#ScrollToTopButton').removeClass('d-none');
            }
            else {
                $('#ScrollToTopButton').addClass('d-none');
            }
        };

    // take back to top on scroll button click
        $('#ScrollToTopButton').on('click', function() {
            $document.body.scrollTop = 0;
            $document.documentElement.scrollTop = 0;
        });


/* VIEW POST PAGE */
    // for add comments toggle icons, switch visible icon on click
        $('.icon-switch').on('click', function() {
            $('div.switch').toggleClass('d-none');
        });

    // from the delete comment modal, if 'delete comment' is selected, submit delete comment form
        $('#submitDeleteCommentButton').on('click', function() {
            $('#deleteCommentForm').submit();
        });


/* ACCOUNT PAGE */



/* CROPPER FUNCTIONS */

// grab data on file input change and launch cropper in modal
    // relates to new post
        $("#id_photo").change(function() {
            if (this.files && this.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    $("#newImage").attr("src", e.target.result);
                    $("#newPostModal").modal("show");
                }
                reader.readAsDataURL(this.files[0]);
            }
        });

    // relates to avatar
        $("#id_avatar").change(function() {
            if (this.files && this.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    $("#avatarImage").attr("src", e.target.result);
                    $("#setAvatarModal").modal("show");
                }
                reader.readAsDataURL(this.files[0]);
            }
        });

// DEFINE VARIABLES
        var $newImage = $("#newImage");
        var $avatarImage = $("#avatarImage");
        var $image;
        var cropBoxData;
        var canvasData;

    // initializes crop box as square
        var setMyCropper = function() {
            $image.cropper({
                viewMode: 1,
                aspectRatio: 1/1,
                minCropBoxWidth: 100,
                minCropBoxHeight: 100,
                zoomOnWheel: false,
                ready: function() {
                    $image.cropper("setCanvasData", canvasData);
                    $image.cropper("setCropBoxData", cropBoxData);
                }
            });
        };

// SCRIPTS TO HANDLE THE CROPPER BOX

    // new post modal stuff
        $("#newPostModal").on("shown.bs.modal", function() {
            $image = $newImage;
            setMyCropper();
        }).on("hidden.bs.modal", function() {
            cropBoxData = $image.cropper("getCropBoxData");
            canvasData = $image.cropper("getCanvasData");
            $image.cropper("destroy");
        });

    // set avatar modal stuff
        $("#setAvatarModal").on("shown.bs.modal", function() {
            $image = $avatarImage;
            setMyCropper();
        }).on("hidden.bs.modal", function() {
            cropBoxData = $image.cropper("getCropBoxData");
            canvasData = $image.cropper("getCanvasData");
            $image.cropper("destroy");
        });

// ADDITIONAL CROPPING FUNCTIONS
        $(".js-zoom-in").click(function() {
            $image.cropper("zoom", 0.1);
        });

        $(".js-zoom-out").click(function() {
            $image.cropper("zoom", -0.1);
        });

        $(".js-landscape-ratio").click(function() {
            $image.cropper("setAspectRatio", 4/3);
        });

        $(".js-portrait-ratio").click(function() {
            $image.cropper("setAspectRatio", 3/4);
        });

        $(".js-square-ratio").click(function() {
            $image.cropper("setAspectRatio", 1/1);
        });

//SCRIPT TO COLLECT THE DATA AND POST TO THE SERVER

    // new post
        $(".js-crop-and-post-new").click(function() {
            var cropData = $image.cropper("getData");
            // console.log(cropData);
            $("#id_x").val(cropData["x"]);
            $("#id_y").val(cropData["y"]);
            $("#id_width").val(cropData["width"]);
            $("#id_height").val(cropData["height"]);
            // front-end form validation is skipped if use .submit() - clicking hidden submit button instead
            $('#submitNewPostButton').click()
        })

    // set avatar
        $(".js-crop-and-upload").click(function () {
            var cropData = $image.cropper("getData");
            console.log(cropData);
            $("#avatar_upload_form #id_x").val(cropData["x"]);
            $("#avatar_upload_form #id_y").val(cropData["y"]);
            $("#avatar_upload_form #id_width").val(cropData["width"]);
            $("#avatar_upload_form #id_height").val(cropData["height"]);
            $("#avatar_upload_form").submit();
        });











    });
</script>
